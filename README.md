# Applied_Electronic_Circuit_Lab (2022.05~2022.06)

&nbsp;

## 🧠 재활완료 판정기

&nbsp;

## 📑 목차

1. [📌 프로젝트 개요](#1--프로젝트-개요)  
2. [🔧 구성 요소](#2--구성-요소)  
3. [💻 사용 기술](#3--사용-기술)  
4. [🧭 동작 흐름 요약](#4--동작-흐름-요약)  
5. [📷 시연 영상/이미지](#5--시연-영상--이미지)  
6. [🌟 기대 효과/ 활용 방안](#6--기대-효과)  

   
&nbsp;
## 📌 프로젝트 개요

본 프로젝트는 팔 또는 다리 등 근육에 심각한 손상을 입어 수축이 불가능한 환자에게  
**재활 여부를 판단하거나, 생체신호 기반의 반응을 인지하여 출력 반응을 유도**하는 시스템을 설계하는 것을 목표로 한다.

근전도(EMG) 신호를 통해 근육의 수축 유무 및 정도를 실시간으로 측정하고,  
해당 신호가 특정 기준 이상일 경우 음향 출력을 통해 반응을 제공한다.
 
&nbsp;

### 🎯 기획 의도

- 근육 기능이 저하된 환자의 상태를 판단하고, 일정 회복 수준 도달 여부를 직관적으로 전달
- 비침습적인 근전도 측정을 통해 재활 가능성을 평가하고, 훈련 동기를 제공
- 생체신호 기반의 인터페이스를 활용하여 의사소통 또는 반응 보조 장치로도 활용 가능
  
&nbsp;

### 🏭 기존 기술의 활용과 확장 가능성

- 표면 근전도 측정 기술을 활용하여 피부 위에 전극을 부착하고 전기적 신호를 분석
- EMG 신호를 증폭 회로(Amplifier)를 통해 5V 이상으로 증폭 시, 피드백 음성 출력 구현
- 인체의 공명 주파수(Resonance Frequency)를 고려한 신호 해석으로 정확한 판단 기반 확보

&nbsp;

### ✅ 확장 가능성

- **재활 치료 평가 시스템**: 정량적 근육 회복 측정 지표 제공
- **근육 반응 기반 알림 시스템**: 특정 조건에서 알람, 소리 등 외부 장치 연동
- **뇌-근육-기계 인터페이스 연구의 기초 자료**로 활용 가능
- 고령자나 환자의 **자가 운동 추적 및 피드백 장치**로 확장 가능



&nbsp;
## 2. 🔧 구성 요소

| 구성 요소                           | 설명                                                                                         |
|------------------------------------|----------------------------------------------------------------------------------------------|
| 1N4002 다이오드                    | 정류 및 역전압 보호용 일반 다이오드                                                         |
| 도시바 9V 건전지                   | 회로 전원 공급용 전원 소자                                                                  |
| TL082CP 오퍼앰프                   | 저잡음, 듀얼 연산 증폭기. 생체 신호 증폭 회로에 사용                                        |
| Round IC Socket (08P, 14P)         | IC 칩 탈부착을 용이하게 하기 위한 소켓                                                      |
| AT-1750-TFL-LW95-R                 | 생체 신호 증폭 후 조건 만족 시 소리 출력용 스피커                                          |
| EIC-106 회로보드                   | 전체 회로 구성 및 납땜용 기판                                                                |
| 100uF 6.3V 전해콘덴서              | 전원 노이즈 제거 및 신호 안정화용                                                           |
| LM339 비교기                       | 입력 신호와 기준값을 비교하여 디지털 신호로 변환                                           |
| PCB 보드 (Dual Half Size)         | 실험용 회로 구성 시 아두이노/모듈 장착용 브레드보드                                         |
| AD620BNZ 인스트루멘테이션 앰프     | 고정밀 생체 신호 증폭용. 전극 간 미세 전위차 증폭에 사용                                    |


&nbsp;

<img width="1328" height="908" alt="image" src="https://github.com/user-attachments/assets/19d921d6-f596-4d88-84ec-da9a4cb9e17d" />

<img width="1208" height="876" alt="image" src="https://github.com/user-attachments/assets/38f5e0eb-e1c6-4f36-921f-bebbebef0af9" />

<img width="1345" height="284" alt="image" src="https://github.com/user-attachments/assets/dea76b85-a19a-4cce-b183-d5ad14f5ba2d" />


&nbsp;
<img width="821" height="280" alt="image" src="https://github.com/user-attachments/assets/3ebcf197-adfd-4b89-9ded-90b3fcc41b4e" />

<img width="928" height="416" alt="image" src="https://github.com/user-attachments/assets/fb95ef9d-be8b-49e3-a99e-9eb19074e23f" />

## 3. 💻 사용 기술

| 기술                     | 내용                                                                                       |
|--------------------------|--------------------------------------------------------------------------------------------|
| 💻 OS 및 환경            | Unity 2022.3 LTS, OpenCV for Unity, NavMesh 기반 경로 계획                                |
| 💬 사용 언어              | C#, Python (병원 선택 알고리즘, 시뮬레이션 로직 일부)                                       |
| 🔗 통신/시스템 구조       | Unity 내부 스크립트 기반 상태 전이 및 이벤트 기반 로직 처리                                 |
| 📍 위치 및 경로 제어      | NavMesh를 통한 이동 가능 구역 정의 및 경로 자동 생성                                       |
| 👁️ 차선 인식 시스템       | 카메라 + OpenCV (그레이스케일 → Canny 엣지 검출 → 허프 변환으로 중앙선/점선/가장자리선 검출) |
| 🧠 병원 선택 알고리즘     | 증상/중증도 기반 매칭 + 거리 + 병원 혼잡도 기반 우선순위 점수 계산                         |
| 🚑 앰뷸런스 배정 및 이동  | 가장 가까운 사용 가능 앰뷸런스 배정 후 이동 / 대기 리스트 순차 처리                         |
| ⚠️ 충돌 회피 시스템       | Unity Raycast 기반 전방 20m 차량 감지 → 차선 변경 or 속도 조절 수행                         |
| 🏥 가상 병원/도시 구현    | SimplePoly City Low Poly Assets + 사용자 정의 병원/앰뷸런스 Prefab 사용                     |


&nbsp;
## 4. 🧭 동작 흐름 요약
<img width="1272" height="618" alt="image" src="https://github.com/user-attachments/assets/67413147-9c72-4b5e-aa2a-0a3404333f03" />

### 🏥 1. 병원 시스템 (Hospital System)

<img width="600" alt="병원 시스템 이미지1" src="https://github.com/user-attachments/assets/0166dceb-dda2-4f6e-95df-c504b9aa02f0" />
<img width="300" alt="병원 시스템 이미지2" src="https://github.com/user-attachments/assets/a5ddc868-2ccf-4d4d-a410-53f0ded87d1e" />

&nbsp;

병원 시스템은 크게 **환자(People)**, **병원(Hospitals)**, **앰뷸런스(Ambulances)** 의 세 가지 요소로 구성됩니다.

&nbsp;

### 📌 시스템 구성 흐름

1. **환자 요청 발생**
   - 환자의 요청은 **포아송 분포(Poisson Distribution)**를 기반으로 무작위로 생성되며,  
     각 요청은 **증상(Symptom)**과 **위급도(Severity: 1~5)** 정보를 포함합니다.
   - 증상 종류: 신경외과, 심장과, 내과, 외과, 흉부외과, 소아과, 정신과, 산부인과 등

2. **병원 선택 기준**
   - 해당 증상과 위급도에 맞는 의료 인력이 단 한 곳의 병원에만 존재할 경우, 해당 병원으로 바로 배정됩니다.
   - 여러 병원이 가능한 경우, 아래 기준으로 **우선순위 점수(Priority Score)**를 계산합니다:
     - **거리 순위(Proximity Rank)**: 가장 가까운 병원 = 1, 두 번째 = 2 ...
     - **혼잡도 점수(Congestion Score)**: 낮음 = 1, 높음 = 2
     - → 두 값을 합산하여 총점이 가장 낮은 병원을 선택  
     - 점수가 동일한 경우에는 무작위로 하나를 선택

3. **앰뷸런스 배정 및 출동**
   - 가장 가까운 대기 중인 앰뷸런스를 환자에게 배정  
   - 가장 가까운 앰뷸런스가 사용 중일 경우, 그다음 가까운 대기 앰뷸런스를 배정  
   - 배정된 앰뷸런스는 환자 위치로 이동 → 환자 픽업 → 지정 병원으로 이송

4. **대기 리스트 관리**
   - 사용 가능한 앰뷸런스가 없을 경우, 요청은 **대기 리스트(Waitlist)**에 추가  
   - 앰뷸런스가 이송을 마치고 복귀하면, 대기 리스트에서 **순차적으로** 다음 요청을 처리


&nbsp;

### 🚑 2. 앰뷸런스 - 차선 인식 시스템 (Lane Detection)

<img width="800" alt="차선 인식 이미지" src="https://github.com/user-attachments/assets/f48e8c97-4ac4-41ff-b5e2-11432cd82aee" />

&nbsp;

- 차량에 장착된 **카메라가 1초마다 도로 이미지를 캡처**
- OpenCV를 통해 다음 과정을 거쳐 차선을 검출:
  1. 관심 영역(ROI) 설정
  2. 그레이스케일 변환
  3. Canny 엣지 검출
  4. 허프 변환(Hough Transform)으로 선 인식
     
&nbsp;

<img width="600" alt="차선 예시 이미지" src="https://github.com/user-attachments/assets/d0f8b8cb-1e9c-45c3-a1b2-ff88ea31dd2a" />
&nbsp;

### 🛣️ 도로 구조
- **4차선 구조 (2개 차선 × 양방향)**
- 선은 세 가지로 분류:
  - 중앙선 (Central Line)
  - 점선 (Dashed Line)
  - 가장자리 선 / 진입 금지 (Edge / Not Walkable)

&nbsp;

### 🚘 차선 정의
- **Lane 1**: 점선과 가장자리 선 사이  
  → 카메라 뷰: `중앙선 → 점선 → 가장자리 선` → 현재 차량은 Lane 1
- **Lane 2**: 중앙선과 점선 사이  
  → 카메라 뷰: `점선1 → 중앙선 → 점선2` → 현재 차량은 Lane 2

> 일반 차량은 Lane 1 또는 Lane 2에서만 주행 가능하며,  
> **앰뷸런스는 필요 시 중앙선을 넘어갈 수 있음** (단, 주변 차량이 없을 때만 허용)

<img width="690" height="786" alt="image" src="https://github.com/user-attachments/assets/d245385a-1ea6-41eb-9a7c-a62a2f68be7e" />

&nbsp;


### 🚨 3. 앰뷸런스 - 충돌 회피 시스템 (Avoid Collision)

<img width="700" alt="충돌 회피 이미지" src="https://github.com/user-attachments/assets/4e8172a8-2391-4780-b1a5-45abf2317cdf" />

&nbsp;

- **Unity의 Raycast**를 사용하여 차량 전방 **20m 이내**에 다른 차량이 있는지 탐지  
- 감지 시 **자동으로 회피 동작 수행**

&nbsp;

### ⚙️ 속도 제어
- 기본 속도: `5f`  
- 감속 시: `3f`  
- 가속 시: 최대 `7f`

&nbsp;

### 🚧 회피 시나리오

1. **일반 차량 또는 앰뷸런스 간 회피**
   - 인접 차선이 비어 있으면 → 해당 차선으로 **차선 변경**
   - 인접 차선이 막혀 있으면 → **속도 감속**

2. **앰뷸런스 vs 일반 차량**
   - 인접 차선이 비어 있으면 → 앰뷸런스가 **차선 변경 후 가속**
   - 인접 차선이 막혀 있지만, 앞 차량이 이동 가능하면 → **앞 차량이 가속하여 공간 확보**
     - 앰뷸런스는 그대로 주행하며 속도를 높임
   - 앞 차량도 이동 불가능한 경우 → **기존 차선 및 속도 유지**


&nbsp;

### ✅ 결과

본 연구는 한국 응급의료 시스템의 구조적 문제를 해결하기 위해 Unity 기반의 가상 병원 이송 시스템을 설계 및 구현하였다.  
시스템은 독일의 병원 이송 사례를 참고하여, 효율적인 병원 선택 알고리즘, 자율주행 응급차, 충돌 회피 알고리즘을 포함한 통합 솔루션을 제안하였다.

- 환자의 생존율 향상과 병원 및 구급차 자원의 최적 활용을 목표로 함
- NavMesh 기반 가상 도시 맵을 구현하여 이동 가능/불가능 지역을 정밀하게 구분
- 환자의 증상 및 중증도 기반 병원 선택, 거리 최적화, 대기 시간 관리 포함
- Unity + OpenCV를 활용하여 차선 인식 및 주행 안정성 확보
- 충돌 회피 알고리즘을 통해 긴급 차량 간 충돌 예방 및 교통 흐름 유지

> 본 시스템은 실제 환경을 반영한 복합적인 의료 시뮬레이션 플랫폼으로 활용 가능하며,  
> 병원 선택 → 앰뷸런스 배차 → 이동 → 충돌 회피까지 일련의 흐름을 체계적으로 자동화함

<img width="1918" height="902" alt="image" src="https://github.com/user-attachments/assets/957f936b-e052-42ed-8a18-5f0a3f1ba203" />



&nbsp;


## 5. 📷 시연 영상 / 이미지

> https://youtu.be/d_6eIf6Bfks

&nbsp;


## 6. 🌟 기대 효과

- 골든타임 확보: 병원 선택 알고리즘과 자율주행을 통해 응급환자 이송 시간 단축
- 의료 자원 최적화: 중증도와 거리, 혼잡도 기반의 배정으로 병원과 응급차 효율 극대화
- 시스템 확장성: 경찰차, 소방차 등 다른 긴급 차량에도 적용 가능
- 디지털 전환 기여: 기존 전화 기반 수작업 의료 시스템에서 벗어나 자동화된 판단 구조 제시
- 사회적 파급력: 응급 이송 시스템의 글로벌 표준화에 기여할 가능성 보유


&nbsp;

### 🛠️ 활용 방안

- 가상 시뮬레이션 플랫폼: 의료 정책 또는 기술 개선 효과 사전 검증
- 긴급 차량 운행 시스템 설계: 자율주행 기반 소방차, 경찰차 등 적용
- 교육/훈련 도구: 응급 구조 인력 및 의료진 대상 시나리오 기반 훈련 시스템
- AI 알고리즘 테스트 환경: 병원 선택, 충돌 회피 등 알고리즘의 효과 및 개선 실험


&nbsp;

### 🔍 결론 및 제언

본 연구는 Unity 기반의 가상 환경에서 자율주행 응급차, 병원 선택, 충돌 회피 등을 통합한  
응급 의료 이송 시스템의 모델을 제시하였으며, 이는 한국의 응급 의료 체계 디지털화를 위한  
핵심 기반 기술로 활용될 수 있다.

하지만 다음과 같은 한계와 과제가 존재한다:

- 실제 환경에서는 복합 증상, 병원 수용 능력, 의료진 실시간 가용성 등 더 복잡한 요인 존재
- 병원 간 실시간 데이터 연동과 정보 공유를 위한 중앙 통합 시스템 구축 필요
- 개인정보 보호, 보안성 확보 등 법적/윤리적 고려가 필수
- 실제 도로 환경의 복잡성(파손된 차선, 교차로, 보행자 등) 반영이 미흡
- HD Map, 다중 센서(LiDAR, Radar 등), 실제 차량 데이터 기반의 현장 테스트 필요


&nbsp;

### 📌 향후 제언

- 고도화된 의사결정 모델 개발 (우선순위, 중증도, 병상 가용성 등 다변수 통합 판단)
- 현실 데이터 기반 필드 테스트 병행 (다양한 도로/사고 상황 포함)
- 안전성 중심 평가 체계 마련 (교통 법규, 협조 운전, 급정거 등 시나리오 기반 테스트)
- 법적·사회적 수용성 확보를 위한 협력 (병원, 정부, 기술 기업 간 연계 필요)

> 최종적으로, 본 연구는 응급 의료 시스템의 미래형 전환 가능성을 입증하며  
> 실제 의료 현장에 적용하기 위한 정밀한 확장 연구와 협업이 절실히 요구된다.

&nbsp;
